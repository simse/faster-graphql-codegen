name: PR Checks

on:
  pull_request:

jobs:
  build:
     runs-on: ubuntu-latest
     steps:
       - name: Checkout repository
         uses: actions/checkout@v4

       - uses: extractions/setup-just@v1

       - name: "Set up Go"
         uses: actions/setup-go@v5
         with:
            go-version: '1.23.1'

       - name: Build
         run: just build

  lint:
     runs-on: ubuntu-latest
     steps:
       - name: Checkout repository
         uses: actions/checkout@v4

       - uses: extractions/setup-just@v1

       - name: "Set up Go"
         uses: actions/setup-go@v5
         with:
            go-version: '1.23.1'

       - name: Install staticcheck
         uses: dominikh/staticcheck-action@v1.2.0
         with:
           version: '2024.1.1'
           install-go: false
           min-go-version: '1.23.1'

       - name: Run lint
         run: just lint

  unit-test:
     runs-on: ubuntu-latest
     steps:
       - name: Checkout repository
         uses: actions/checkout@v4

       - uses: extractions/setup-just@v1

       - name: "Set up Go"
         uses: actions/setup-go@v5
         with:
            go-version: '1.23.1'

       - name: Unit tests
         run: go test ./...

  format-check:
     runs-on: ubuntu-latest
     continue-on-error: true
     steps:
       - name: Checkout repository
         uses: actions/checkout@v4

       - name: "Set up Go"
         uses: actions/setup-go@v5
         with:
            go-version: '1.23.1'

       - name: Check formatting
         id: check_formatting
         run: test -z $(gofmt -l .)
